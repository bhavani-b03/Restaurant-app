<script>
document.addEventListener("DOMContentLoaded", function() {
    const filterBtn = document.getElementById("filterBtn");
    const filterDropdown = document.getElementById("filterDropdown");
    const priceBtn = document.getElementById("priceBtn");
    const priceDropdown = document.getElementById("priceDropdown");
    const minPriceInput = document.getElementById("startPrice");
    const maxPriceInput = document.getElementById("endPrice");
    const grid = document.querySelector(".grid");
    const dietBtn = document.getElementById("dietBtn");
    const dietDropdown = document.getElementById("dietDropdown");
    const cuisineBtn = document.getElementById("cuisineBtn");
    const cuisineDropdown = document.getElementById("cuisineDropdown");
    const ratingBtn = document.getElementById("ratingBtn");
    const ratingDropdown = document.getElementById("ratingDropdown");
    const form = document.getElementById("filter-form");

    if (!filterBtn || !priceDropdown || !grid || !dietBtn || !dietDropdown || !cuisineBtn || !cuisineDropdown || !form) return; // safety check

    // Toggle popup
    filterBtn.addEventListener("click", () => {
        filterDropdown.classList.toggle("hidden");
    });

    priceBtn.addEventListener("click", () => {
        priceDropdown.classList.toggle("hidden");
    });

    dietBtn.addEventListener("click", (e) => {
        e.preventDefault();
        dietDropdown.classList.toggle("hidden");
    });

    cuisineBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        cuisineDropdown.classList.toggle("hidden");
    });

    document.addEventListener("click", (e) => {
        if (!cuisineDropdown.contains(e.target) && !cuisineBtn.contains(e.target)) {
            cuisineDropdown.classList.add("hidden");
        }
    });

    ratingBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        ratingDropdown.classList.toggle("hidden");
    });

    const dropdownButtons = ["price", "diet", "cuisine", "rating"];

    const dropdowns = dropdownButtons.map(name => ({
        btn: document.getElementById(`${name}Btn`),
        menu: document.getElementById(`${name}Dropdown`)
    }));

    dropdowns.forEach(({ btn, menu }) => {
        if (!btn || !menu) return;

        btn.addEventListener("click", (e) => {
            e.stopPropagation();
            dropdowns.forEach(({ menu: other }) => {
                if (other !== menu) other.classList.add("hidden");
            });
        });
    });

    // Close main filter and all sub dropdowns when clicking outside
    document.addEventListener("click", (e) => {
        const clickedInsideMain = filterDropdown.contains(e.target) || filterBtn.contains(e.target);

        // If clicked outside main filter dropdown
        if (!clickedInsideMain) {
            filterDropdown.classList.add("hidden");
        }

        // Close all sub dropdowns if click is outside them & their buttons
        dropdowns.forEach(({ btn, menu }) => {
            if (!menu.contains(e.target) && !btn.contains(e.target)) {
                menu.classList.add("hidden");
            }
        });
    });

    form.addEventListener("submit", function () {
        form.querySelectorAll("input").forEach(input => {
            if (!input.value) {
                input.disabled = true;
            }
        });
    });

});
</script>
